<html lang="en">
   <head>
      {% include 'head.html' %}
      <title>Collaborate - {{collab_id}}</title>
      <style>
         /* *{
         cursor: none!important;
         } */
         body{
         overflow: hidden;
         }
         .canvas-container{
         background-color: #fff;
         }.more_options{
         position: fixed;
         bottom: 150px;
         right: 10px;
         padding: 10px;
         border-radius: 50px;
         box-shadow: rgba(149, 157, 165, 0.2) 0px 8px 24px;
         z-index: 1000;
         border: 1px solid var(--l);
         }
         .more_options i{
         cursor: pointer;
         font-size: 15px;
         }.more_options >div{
         margin-top: 10px;
         margin-bottom: 10px;;
         }   .chatbox-container {
         width: 300px;
         box-shadow: rgba(149, 157, 165, 0.2) 0px 8px 24px;
         overflow: hidden;
         border-radius:10px;
         background-color: #fff;
         }.chatbox-header>h5{
         color: #fff!important;margin-bottom: 0;
         }.chatbox-header>p,.chatbox-header span{margin-bottom: 0;
         color: #fff;font-size: 14px;margin-top: 5px;
         }
         .chatbox-header {
         height: 70px;
         box-shadow: rgb(0 0 0 / 8%) 1.95px 1.95px 2.6px;
         padding: 10px;;
         display: flex;
         align-items: center;
         justify-content: space-between;
         }.chat-left,.group-info{
         display: flex;
         align-items: center;
         }.chat-right{
         height:50px;
         width: 50px;
         display: flex;
         align-items: center;
         justify-content: center;
         cursor: pointer;
         }.group_make_flex{
         display: flex;align-items: center;
         } .group_make_flex >span{
         margin-left: 3px;;
         }.group_make_flex >span:nth-child(1){
         margin-left: 10px;
         }.mycollabid{
         margin-left: 10px;
         color: #222 !important;
         font-weight: bold;
         font-size: 15px !important;
         }
         .chatbox-header img{
         height:50px;
         width:50px;
         /* border:1px solid var(--p);
         border-radius: 50px;; */
         }
         .chatbox-header:before {
         /* background-image: url('https://client.crisp.chat/static/images/tiles/signal.svg') !important;
         background-size: 72px !important;
         opacity: 0.075 !important;
         height: 150px;
         content: "" !important;
         background-repeat: repeat !important;
         position: absolute !important;
         inset: 0 !important;
         z-index: 0 !important; */
         }
         .users{
         /* display: flex;margin-bottom: 10px; */
         }.users .ava {
         /* width: 40px;
         height: 40px;
         border-radius: 50%;
         border: 2px solid var(--p);background-color: #fff;
         padding: 5px;
         margin-left: -10px;
         z-index: 1;display: flex;
         align-items: center;
         justify-content: center; */
         }.ava{
         }
         .users .ava:first-child {
         /* margin-left: 0; Reset margin for the first avatar */
         }
         .chatbox-body {
         padding: 10px;
         height:300px;
         overflow-y: auto;
         }
         .chatbox-body > div {
         max-width: 80%;
         padding: 5px 10px;
         display: table;
         margin-bottom: 3px;
         border-radius: 5px;
         }.messages_main input{
         background: #efefef96;
         font-size: 14px;
         border-radius: 50px;
         border-top-right-radius:50px!important;
         border-bottom-right-radius:50px!important;
         }.messages_main input:focus{
         background: #efefef96;
         border:1px solid var(--p);
         }.messages_main button i{
         color:#fff;
         }
         .sent_message {
         float: right;
         background-color: var(--p);
         clear: both; /* Fixes the issue where messages might overlap */
         }.sent_message>p{
         color: #fff;
         }
         .received_message {
         float: left;
         background-color: var(--l);
         clear: both; /* Fixes the issue where messages might overlap */
         }
         .chatbox-body::after {
         content: "";
         display: table;
         clear: both;
         }
         .chatbox-body > div p {
         margin-bottom: 0;
         }
         .messager_name {
         text-transform: uppercase;
         font-size: 14px;
         color: var(--p);
         }
         .message {
         font-size: 14px;
         color: #222;
         }.online_now{
         width:10px;
         height: 10px;
         background-color: #0CCE6B;border-radius: 50px;
         display: block;
         }.part,.part_text{
         color: #444 !important;
         }
         .chatbox-footer {
         padding: 10px;
         border-top: 1px solid var(--l);
         height: 50px;
         }.send_sms button{
         height: 30px;
         width: 30px;
         display: flex;
         border-radius: 50px!important;
         align-items: center;
         margin-left: 10px!important;
         background: var(--p) !important;
         justify-content: center;
         }
         .chat-input {
         width: 100%;border: none;
         outline: none;
         border: none !important;
         }.chat-input:focus{
         border: none;box-shadow: unset!important;
         }
         .messages_main {
         position: fixed;
         bottom: 30px;
         height: 420px !important;    z-index: 99999999;
         right: 30px;
         }.message_num{
         position: absolute;
         background-color: rgb(185, 3, 3);color: #fff;font-size: 13px;border-radius: 20px;
         height: 23px;
         width: 23px;
         display: flex;
         align-items: center;
         justify-content: center;
         top: -10px;;right: -10px;;
         }.messages_main{
         display: none;
         }  .fixed-bottom-middle {
         position: fixed;
         bottom: 20px;
         border: none;
         left: 50%;
         transform: translateX(-50%);
         z-index: 1050;
         background: #fff;
         border-radius: 30px;
         height: 30px;
         display: flex;
         align-items: center;
         justify-content: center;
         box-shadow: rgba(14, 63, 126, 0.04) 0px 0px 0px 1px, rgba(42, 51, 69, 0.04) 0px 1px 1px -0.5px, rgba(42, 51, 70, 0.04) 0px 3px 3px -1.5px, rgba(42, 51, 70, 0.04) 0px 6px 6px -3px, rgba(14, 63, 126, 0.04) 0px 12px 12px -6px, rgba(14, 63, 126, 0.04) 0px 24px 24px -12px;
         }
         .socketError {
         position: fixed;
         bottom: 20px;
         left: 50%;
         transform: translateX(-50%);
         z-index: 1050;
         }
         /*****************/
         video{
         width: inherit;
         height: inherit;
         border-radius: 5px;object-fit: cover;
         }
         .onkar_main_video_outer_container{
         background-color: #0000007d;position: absolute;
         top:50%;
         left: 50%;
         transform: translate(-50% , -50%);
         height: 0;
         width: 0%;z-index: -10000;
         }
         .onkar_users{
         width: 70%;
         height: auto;
         max-width:80%;
         max-height: 80vh;
         border-radius: 10px;
         background-color: #fff;
         position: absolute;
         top:50%;
         left:50%;
         transform: translate(-50% , -50%);
         }.onkar_users_{
         position: relative;
         width: 100%;
         height: 80vh;
         background-color: #fff;
         border-radius: 10px;
         }#onkar_user_close{
         background-color: red;
         width:20px;
         height:20px;
         padding:20px;
         display: flex;
         align-items: center;
         justify-content: center;
         top:-20px;position: absolute;
         right:-20px;border-radius: 5px;
         cursor: pointer;
         color:#fff;z-index: 10000000000;
         }.remote_videos{
         overflow-y:auto;
         padding: 20px;
         max-height: 100%;
         display: grid;
         grid-template-columns: repeat(auto-fit, 300px);
         gap: 1rem;
         justify-content: center; 
         }.onkar_user_video_container{
         background-color: #cfcfcf;
         width:300px;
         height:200px;
         border-radius: 5px;;
         position: relative;
         }.my_video_options{
         position: absolute;
         width: 100%;
         bottom: 10px;
         display: flex;
         align-items: center;
         justify-content: center;
         z-index:999999;
         }.video_off,.mic_off,.video_pin{
         min-width: 40px;
         min-height: 40px;
         background-color: #000;
         display: flex;
         align-items: center;
         justify-content: center;
         margin-left: 10px;
         margin-right: 10px;
         border-radius: 50px;
         cursor: pointer;
         }.video_off i ,.mic_off i,.video_pin i{
         color: #fff;
         font-size: 13px;
         }.caller_name{
         height: 40px;
         background-image: linear-gradient(#00000069, #fff0);
         position: absolute;
         top: 0;
         left: 0;
         width: 100%;
         display: flex;
         align-items: center;
         justify-content: center;
         border-radius: 5px;
         }.caller_name p{
         margin-left: 15px;
         color: #fff;
         font-weight: bold;
         margin-bottom: 0;
         }
         .pin_video_here_and_draggable{
         width:200px;
         height:130px;
         position: fixed;
         right: 20px;
         bottom: 20px;
         z-index: 10000;
         background-color: #000;
         border-radius: 5px;;
         }.pin_video_here_also{
         height: 300px;
         width: 100%;;
         background-color: #000;
         border-radius: 5px;;
         }    .custom-cursor {
         position: absolute;
         width: 20px;
         height: 20px;z-index:9999999999999;
         background: url("../static/images/cursor.png") no-repeat center center; /* Replace with your cursor image URL */
         background-size: contain;
         pointer-events: none;
         }
      </style>
      <script>
         $(document).ready(function(){
             $("#onkar_user_close").click(function(){
         $(".onkar_main_video_outer_container").animate(
         { width: "0", height: "0" }, 
         300,
         function() {
         $(this).css({"z-index":"-10000"});
         }
         );
         });
         $(".showUsers").click(function(){
         $(".onkar_main_video_outer_container").animate(
         { width: "100%", height: "100vh" }, 
         300,
         function() {
            $(this).css({"z-index":"999"});
         }
         );
         });
         });
         
      </script>
   </head>
   <body>
      <!-- <div class="custom-cursor" id="cursor"></div>
      <script>
         const cursor = document.getElementById('cursor');
         
         document.addEventListener('mousemove', (e) => {
           cursor.style.left = `${e.pageX}px`;
           cursor.style.top = `${e.pageY}px`;
         });
      </script> -->
      <!---------------- temp-->
      <!-- <div class="pin_video_here_and_draggable"></div> -->
      <div class="onkar_main_video_outer_container">
         <div class="onkar_users">
            <div class="onkar_users_">
               <div id="onkar_user_close">
                  <i class="fi fi-rr-cross-small"></i>
               </div>
               <!-- <div class="pin_video_here_also"></div> -->
               <div class="remote_videos" id="remote_videos">
                  <div id="myid" class="onkar_user_video_container">
                     <div class="caller_name">
                        <p>You</p>
                     </div>
                     <div class="my_video_options">
                        <div class="video_off" onclick="toggleCamera()">
                           <i class="fi fi-rr-video-camera"></i>
                        </div>
                        <div class="mic_off" onclick="toggleMic()">
                           <i class="fi fi-rr-volume-mute"></i>
                        </div>
                        <!-- <div class="video_pin pin_me">
                           <i class="fi fi-rr-thumbtack"></i>
                           </div> -->
                     </div>
                  </div>
               </div>
            </div>
         </div>
      </div>
      <!--------------------------->
      <input hidden value="{{sender_name}}" class="user_name">
      <canvas id="canvas" style="position: relative;" height="600" width="700"></canvas>
      <div class="tools">
         <div title="change"><i class="fi fi-rr-arrows"></i></div>
         <div title="square"><i class="fi fi-rr-square"></i></div>
         <div title="circle"><i class="fi fi-rr-circle"></i></div>
         <div title="triangle"><i class="fi fi-rr-triangle"></i></div>
         <div title="pencil"><i class="fi fi-rr-attribution-pencil"></i></div>
         <div title="stroke">
            <i class="fi fi-rr-grip-lines"></i>
            <div class="lines" style="display: none;">
               <div style="border:1px solid #000;" title="1">1px</div>
               <div style="border:1px solid #000;" title="2">2px</div>
               <div style="border:1px solid #000;" title="3">3px</div>
               <div style="border:1px solid #000;" title="4">4px</div>
               <div style="border:1px solid #000;" title="5">5px</div>
            </div>
         </div>
         <div title="font"><i class="fi fi-rr-text"></i></div>
         <div title="fill" style="position: relative;">
            <i class="fi fi-rr-palette"></i>
            <div class="colors" style="display: none;">
               <div style="background-color: #582B11;" title="#582B11"></div>
               <div style="background-color: #AF125A;" title="#AF125A"></div>
               <div style="background-color: #4F6D7A;" title="#4F6D7A"></div>
               <div style="background-color: #DD6E42;" title="#DD6E42"></div>
               <div style="background-color: #379634;" title="#379634"></div>
               <div style="background-color: #201E1F;" title="#201E1F"></div>
               <div style="background-color: #a8d0e6;" title="#a8d0e6"></div>
               <div style="background-color: #FF4000;" title="#FF4000"></div>
               <div style="background-color: #50B2C0;" title="#50B2C0"></div>
               <div style="background-color: #ffffff;" title="#ffffff"></div>
               <div style="background-color: #0CCE6B;" title="#0CCE6B"></div>
               <div style="background-color: #363537;" title="#363537"></div>
               <div style="background-color: #2E5077;" title="#2E5077"></div>
               <div style="background-color: #000000;" title="#000000"></div>
               <div style="background-color: #FFE347;" title="#FFE347"></div>
               <div style="background-color: #6457A6;" title="#6457A6"></div>
            </div>
         </div>
         <div title="delete"><i class="fi fi-rr-trash"></i></div>
         <div title="chats" onclick="broadcast()"><i class="fi fi-rr-phone-call"></i></div>
         <div title="Users" class="showUsers"><i class="fi fi-rr-users"></i></div>
         <div title="Join" class="relative" onclick="message__()">
            <i class="fi fi-rr-messages"></i>
            <div class="message_num">0</div>
         </div>
      </div>
      <!---- -->
      <!-- <div class="more_options">
         <div class="relative" onclick="message__()">
            <div class="message_num">0</div>
            <i class="fi fi-rr-messages"></i>
         </div>
         <div onclick="toggleVideos()"><i class="fi fi-rr-users-alt"></i></div>
         <div class="mic" onclick="broadcast()"><i class="fi fi-rr-circle-microphone"></i></div>
         </div> -->
      <div class="messages_main">
         <div class="chatbox-container">
            <div class="chatbox-header">
               <!-- <div class="users">
                  <div class="ava"><i class="fi fi-rr-user"></i></div>
                  <div class="ava"><i class="fi fi-rr-user"></i></div>
                  <div class="ava"><i class="fi fi-rr-user"></i></div>
                  <div class="ava"><i class="fi fi-rr-user"></i></div>
                  </div>
                  <h5>Collab - {{collab_id}}</h5>
                  <p><span class="edit_no_of">0</span> Participants Joined!</p> -->
               <div class="chat-left">
                  <div class="group-info">
                     <img src="https://cdn-icons-png.flaticon.com/256/9821/9821327.png">
                     <div>
                        <span class="mycollabid">Collab - {{collab_id}}</span>
                        <div class="group_make_flex">
                           <span class="online_now"></span>
                           <span class="part">0</span>
                           <span class="part_text">Participants</span>
                        </div>
                     </div>
                  </div>
               </div>
               <div class="chat-right" onclick="closeChat()">
                  <i class="fi fi-rr-cross-small"></i>
               </div>
            </div>
            <div class="chatbox-body">
               <!-------------------------MESSAGES GOES HERE ---------------------------->
            </div>
            <div class="chatbox-footer">
               <form class="send_sms">
                  <div class="input-group">
                     <input type="text" class="form-control chat-input" placeholder="Type a message" required>
                     <button class="btn btn-primary" type="submit"><i class="fi fi-rr-paper-plane-top"></i></button>
                  </div>
               </form>
            </div>
         </div>
      </div>
      <p class="fill" hidden>transparent</p>
      <p class="stroke" hidden>#000000</p>
      <p class="stroke_" hidden>1</p>
      <p class="sender" hidden>{{sender}}</p>
      <p class="collab_id" hidden>{{collab_id}}</p>
      <p class="sender_name" hidden>{{sender_name}}</p>
      <div id="alert" class="alert alert-success fixed-bottom-middle" role="alert" style="display: none;">
         <!-- Dynamic content will be inserted here -->
      </div>
      <script>
         //  if (window.innerWidth <= 700) {
         //    document.body.innerHTML = "";
         //    const messageDiv = document.createElement("div");
         //    messageDiv.style.display = "flex";
         //    messageDiv.style.alignItems = "center";
         //    messageDiv.style.justifyContent = "center";
         //    messageDiv.style.height = "100vh"; 
         //    messageDiv.textContent = "INCOMPATIBLE SCREEN SIZE :(";
         //    document.body.appendChild(messageDiv);
         //  }
          
         
          function showAlert(message) {
            var alertElement = document.getElementById('alert');
            alertElement.innerHTML = message;
            alertElement.style.display = 'block';
            setTimeout(function() {
                alertElement.style.display = 'none';
            }, 3000);
          }
          
          function init_0(text) {
            if ($("." + text).text() == 0) {
                $("." + text).css({
                    "visibility": "hidden"
                });
            } else {
                $("." + text).css({
                    "visibility": "visible"
                });
            }
          }
          
          function message__() {
            $(".message_num").text(0);
            $(".messages_main").toggle(100);
            init_0("messages_main");
          }
          init_0("message_num");
          $(document).ready(function() {
            $(".send_sms").on('submit', function(e) {
                e.preventDefault();
                var mess = $(".chat-input").val();
                $(".chatbox-body").append(' <div class="sent_message"><p class="message">' + mess + '</p></div>');
                $(this)[0].reset();
                $(".chatbox-body").scrollTop($(".chatbox-body")[0].scrollHeight);
                sendMessage({
                    'message': {
                        collab_id: $(".collab_id").text(),
                        sender: $(".sender").text(),
                        sender_name: $(".sender_name").text(),
                        message: mess,
          
                    },
                    'shape': 'message'
                });
            });
          });
      </script>
      <script>
         function findObjectById(id) {
           return canvas.getObjects().find(obj => obj.id === id);
         }
         
         function updateShapeData(id, newData) {
           const obj = findObjectById(id);
           if (obj) {
               obj.set(newData); // Update the shape's data
               obj.setCoords(); // Recalculate the coordinates of the object's bounding box
               canvas.renderAll(); // Rerender the canvas to reflect the changes
           } else {
               console.error("NOT FOUND : " + id);
           }
         }
         
         function handleShapeData(data) {
           const {
               message
           } = data;
           let radius = message.radius === undefined ? 50 : message.radius;
         
           const shapeConfig = {
               id: message.id,
               left: message.left,
               top: message.top,
               angle: message.angle,
               fill: message.fill,
               stroke: message.stroke,
               strokeWidth: message.strokeWidth,
               width: message.width,
               height: message.height,
               radius: radius,
         
         
           };
         
         
           let shapeType = data.shape === "rect" ? "square" : data.shape;
         
           switch (shapeType) {
               case "square":
                   if (message.type === "NEW") {
                       canvas.isDrawingMode = false;
                       canvas.add(new fabric.Rect(shapeConfig));
                   } else {
                       updateShapeData(message.id, shapeConfig);
                   }
                   break;
         
               case "circle":
                   if (message.type === "NEW") {
                       canvas.isDrawingMode = false;
                       canvas.add(new fabric.Circle(shapeConfig));
                   } else {
                       updateShapeData(message.id, shapeConfig);
                   }
                   break;
         
               case "triangle":
                   if (message.type === "NEW") {
                       canvas.isDrawingMode = false;
                       canvas.add(new fabric.Triangle(shapeConfig));
                   } else {
                       updateShapeData(message.id, shapeConfig);
                   }
                   break;
               case "delete":
                   if (message.type === "delete") {
                       canvas.remove(findObjectById(message.id));
                       canvas.discardActiveObject();
                       canvas.renderAll();
         
                   }
                   break;
               case "font":
         
                   if (message.type_ === "NEW") {
                       canvas.add(new fabric.Textbox('TEXT HERE', {
                           left: message.left,
                           top: message.top,
                           width: message.width,
                           fontSize: message.fontSize,
                           editable: message.editable,
                           backgroundColor: message.backgroundColor,
                           borderColor: message.borderColor,
                           fontFamily: message.fontFamily,
                           fill: message.fill,
                           id: message.id,
                       }));
                   } else {
                       var obj = findObjectById(message.id);
                       if (obj) {
                           obj.set({
                               text: message.text
                           });
                           obj.setCoords();
                           canvas.renderAll();
                       } else {}
                   }
                   break;
               case "path":
                   if (message.type === "NEW") {
         
                       const pathData = message.data.path;
                       const fillColor = message.data.fill;
                       const strokeColor = message.data.stroke;
                       const strokeWidth = message.data.strokeWidth;
                       const pathId = message.data.id;
                       var da = {
                           fill: fillColor, // Set the fill color
                           stroke: strokeColor, // Set the stroke color
                           strokeWidth: strokeWidth, // Set the stroke width
                           id: pathId, // Set the ID (optional)
                       };
                       const path = new fabric.Path(pathData, da);
         
         
                       canvas.add(path);
                       canvas.renderAll();
         
         
                   } else {
                       updateShapeData(message.id, shapeConfig);
                   }
                   break;
               case "textbox":
                   updateShapeData(message.id, shapeConfig);
                   break;
               default:
                   console.error("Unsupported shape type:", data.shape);
           }
         }
         
         const collab_id = $(".collab_id").text();
         const sender = $(".sender").text();
         
         if (sender === "False") {
           alert("You are not logged in!");
           window.location.href = `${window.location.protocol}//${window.location.host}/auth/login`;
         } else if (collab_id === "False") {
           alert("Please Provide Collab ID and Password to join!");
           window.location.href = `${window.location.protocol}//${window.location.host}/collab/check`;
         }
         function closeChat(){
            $(".messages_main").hide();
         }
</script>
{% include 'footer.html' %}
</body>
</html>
